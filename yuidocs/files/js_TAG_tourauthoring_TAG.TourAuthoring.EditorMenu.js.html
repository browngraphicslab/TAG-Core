<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js/TAG/tourauthoring/TAG.TourAuthoring.EditorMenu.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/TAG.AnnotatedImage.html">TAG.AnnotatedImage</a></li>
            
                <li><a href="../classes/TAG.Authoring.EditorMenu.html">TAG.Authoring.EditorMenu</a></li>
            
                <li><a href="../classes/TAG.Layout.ArtworkEditor.html">TAG.Layout.ArtworkEditor</a></li>
            
                <li><a href="../classes/TAG.Layout.ArtworkViewer.html">TAG.Layout.ArtworkViewer</a></li>
            
                <li><a href="../classes/TAG.Layout.CollectionsPage.html">TAG.Layout.CollectionsPage</a></li>
            
                <li><a href="../classes/TAG.Layout.InternetFailurePage.js.html">TAG.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/TAG.Layout.StartPage.html">TAG.Layout.StartPage</a></li>
            
                <li><a href="../classes/TAG.Layout.VideoPlayer.html">TAG.Layout.VideoPlayer</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.ArtworkTrack.html">TAG.TourAuthoring.ArtworkTrack</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.AudioTrack.html">TAG.TourAuthoring.AudioTrack</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Command.html">TAG.TourAuthoring.Command</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.ComponentControls.html">TAG.TourAuthoring.ComponentControls</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Display.html">TAG.TourAuthoring.Display</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.ImageTrack.html">TAG.TourAuthoring.ImageTrack</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.InkAuthoring.html">TAG.TourAuthoring.InkAuthoring</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.InkTrack.html">TAG.TourAuthoring.InkTrack</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Keyframe.html">TAG.TourAuthoring.Keyframe</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.PlaybackControl.html">TAG.TourAuthoring.PlaybackControl</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Timeline.html">TAG.TourAuthoring.Timeline</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.TimeManager.html">TAG.TourAuthoring.TimeManager</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.TopMenu.html">TAG.TourAuthoring.TopMenu</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.TourOptions.html">TAG.TourAuthoring.TourOptions</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Track.html">TAG.TourAuthoring.Track</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.UndoManager.html">TAG.TourAuthoring.UndoManager</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.VideoTrack.html">TAG.TourAuthoring.VideoTrack</a></li>
            
                <li><a href="../classes/TAG.TourAuthoring.Viewer.html">TAG.TourAuthoring.Viewer</a></li>
            
                <li><a href="../classes/TAG.Util.Artwork.html">TAG.Util.Artwork</a></li>
            
                <li><a href="../classes/TAG.Util.IdleTimer.html">TAG.Util.IdleTimer</a></li>
            
                <li><a href="../classes/TAG.Util.Splitscreen.html">TAG.Util.Splitscreen</a></li>
            
                <li><a href="../classes/tagInk.html">tagInk</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js/TAG/tourauthoring/TAG.TourAuthoring.EditorMenu.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿TAG.Util.makeNamespace(&#x27;TAG.TourAuthoring.MenuInputFormats&#x27;);
TAG.Util.makeNamespace(&#x27;TAG.TourAuthoring.EditorMenu&#x27;);

TAG.TourAuthoring.MenuInputFormats = {
    minSec: 1,      // 00:00.00 (min:sec.centisecs)
    sec: 2,         // 00 (sec)
    percent: 3      // 0 - 100 (%)
};

TAG.TourAuthoring.MenuType = {
    display: 1,
    keyframe: 2,
    track: 3
};


/**
 * Menu for track, display and keyframe editing
 * @class TAG.Authoring.EditorMenu
 * @constructor
 * @param {Object} spec          value from MenuType enum specifying menu layout
 * @param {Object} my            track&#x27;s shared my object
 * @return {Object} that         the main DOM object
 */
TAG.TourAuthoring.EditorMenu = function (spec, my) {
    &quot;use strict&quot;;
    var that = {
            getMenuCloseable: getMenuCloseable,
            open: open,
            close: close,
            forceClose: forceClose,
            addInput: addInput,
            addTitle: addTitle,
            addButton: addButton,
        },                                                                                                                        // object containing all the public methods of the class
        menu = $(document.createElement(&#x27;div&#x27;)),                                                                                  // the main menu div
        arrow = $(document.createElement(&#x27;img&#x27;)),                                                                                 // the arrow icon on the menu
        menuType = spec.type,                                                                                                     // property of the spec object passed in, sets the type of the menu                                                                                         
        parent = spec.parent,                                                                                                     // the parent display to which the menu is attached
        trackBody = my.timeline.getTrackBody(),                                                                                   // the track on which the editor menu lies
        OPACITY = 0.95,                                                                                                           // opacity of the menu display on screen
        menuCloseable = true,                                                                                                     // boolean specyfying whether or not the menu can be closed
        power = Math.pow(10, TAG.TourAuthoring.Constants.menuDecimals);                                                          // returns the base exponent of the constant passed in

        /**
         * Contains one object for every input in the menu
         * Input objects have parameters:
         * @param {HTML Element} input             The actual HTML input element
         * @param {Value}        format            Format of input, value from MenuInputFormats enum
         * @param {Function}     accessCallback    Function for obtaining current value of linked variable
         * @param {Function}     updateCallback    Function for updating value of linked variable
         */
        var inputObjects = [];

    menu.addClass(&quot;displayMenu&quot;);


    /**Initializes the menu html
     * @method createHTML
     */
    (function createHTML() {
        var width,
            arrowSrc;

        menu.css({
            &quot;position&quot;: &quot;fixed&quot;,
            &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;,
            &#x27;width&#x27;: width,
            &#x27;background-color&#x27;: &#x27;rgba(0,0,0,&#x27; + OPACITY + &#x27;)&#x27;,
            &#x27;padding-top&#x27;: &#x27;3px&#x27;,
            &#x27;padding-left&#x27;: &#x27;2px&#x27;,
            &#x27;padding-right&#x27;: &#x27;2px&#x27;,
            &#x27;z-index&#x27;: TAG.TourAuthoring.Constants.aboveRinZIndex + 7,
            &#x27;border-radius&#x27;: &#x27;15px&#x27;
        });

        // set width according to menu type
        switch (menuType) {     
            case TAG.TourAuthoring.MenuType.display:
                width = &#x27;25%&#x27;;
                break;
            case TAG.TourAuthoring.MenuType.keyframe:
                width = &#x27;18%&#x27;;
                break;
            case TAG.TourAuthoring.MenuType.track:
                width = &#x27;20%&#x27;;
                break;
        }

        // change css according to menu type
        switch (menuType) {     
            case TAG.TourAuthoring.MenuType.display:
                break;
            case TAG.TourAuthoring.MenuType.keyframe:
                break;
            case TAG.TourAuthoring.MenuType.track:
                menu.css({
                    &#x27;left&#x27;: &#x27;18%&#x27;,
                    &#x27;padding&#x27;: &#x27;.5%&#x27;,
                    &#x27;margin-top&#x27;: &#x27;1%&#x27;,
                    &#x27;float&#x27;: &#x27;left&#x27;,
                    &#x27;clear&#x27;: &#x27;left&#x27;,
                    &#x27;border-radius&#x27;: &#x27;5%&#x27;
                });
                break;
        }

        my.track.append(menu);
        menu.hide();
        my.timeline.setisMenuOpen(false);

        // general event bindings for the menu
        menu.on(&#x27;MSPointerDown&#x27;, function (ev) {
            inputObjects.map(updateInput);
            ev.stopImmediatePropagation();
        });
        menu.on(&#x27;mousedown&#x27;, function (event) {
            inputObjects.map(updateInput);
            event.stopImmediatePropagation();
        });
        menu.on(&#x27;click&#x27;, function (event) {
            inputObjects.map(updateInput);
            event.stopImmediatePropagation();
        });

        // set arrow image according to menu type
        switch (menuType) {         
            case TAG.TourAuthoring.MenuType.display:
            case TAG.TourAuthoring.MenuType.keyframe:
                arrowSrc = tagPath+&quot;images/icons/KeyframeInfo-Opaque.png&quot;;
                break;
            case TAG.TourAuthoring.MenuType.track:
                arrowSrc = tagPath + &quot;images/icons/LeftPoint-Opaque.png&quot;;
                break;
        }

        arrow.attr(&quot;src&quot;, arrowSrc);
        arrow.css({
            position: &#x27;fixed&#x27;,
            height: &#x27;45px&#x27;,
            width: &#x27;54px&#x27;,
            &#x27;z-index&#x27;: TAG.TourAuthoring.Constants.aboveRinZIndex + 5,
            &#x27;opacity&#x27;: OPACITY
        });

        // set arrow image css according to menu type
        switch (menuType) {
            case TAG.TourAuthoring.MenuType.track:
                arrow.css({
                    left: &#x27;14%&#x27;,
                    height: &#x27;6%&#x27;,
                    width: &#x27;4%&#x27;
                });
                break;
            default:
                arrow.css({
                    &#x27;margin-top&#x27;: &#x27;-1px&#x27;
                });
                break;
        }

        my.track.append(arrow);
        arrow.hide();
    })();

    /**returns the boolean specifying if the menu can be closed
     * @method getMenuCloseable
     * @return {Boolean} menuCloseable
     */
    function getMenuCloseable() {
        return menuCloseable;
    }

    /**Opens the editor menu
     * @method open
     * @param {Event} evt   evt from interaction event, used to reposition menu
     */
    function open(evt) {
        var close = my.timeline.getCloseMenu();                 // close existing menus
        if (close) { close(); }
        if (my.that.getEventsPaused()) { return; }           
         
        //deselect all tracks and open the menu
        my.timeline.allDeselected();
        my.timeline.setisMenuOpen(true);
        my.timeline.setCloseMenu(forceClose);
        my.that.updateTracksEventsPaused(true);

        // update menu position and contents
        if (evt) { updateMenuPos(evt); }
        resetInputs();

        // remove current selections
        my.currentDisplay = null;
        if (my.currentKeyframe) {
            my.currentKeyframe.setDeselected();
            my.currentKeyframe = null;
        }

        // reattach handlers if they were removed
        if (!menu.data(&#x27;events&#x27;) || !(menu.data(&#x27;events&#x27;).click)) {
            menu.on(&#x27;click&#x27;, function (event) {
                inputObjects.map(updateInput);
                event.stopImmediatePropagation();
            });
        }
        if (!menu.data(&#x27;events&#x27;) || !(menu.data(&#x27;events&#x27;).MSPointerDown)) {
            menu.on(&#x27;MSPointerDown&#x27;, function (ev) {
                inputObjects.map(updateInput);
                ev.stopImmediatePropagation();
            });
        }
        if (!menu.data(&#x27;events&#x27;) || !(menu.data(&#x27;events&#x27;).mousedown)) {
            menu.on(&#x27;mousedown&#x27;, function (event) {
                inputObjects.map(updateInput);
                event.stopImmediatePropagation();
            });
        }

        // logic to close menu
        my.root.on(&#x27;mousedown.editorMenu&#x27;, function (event) {
            var i,
                ancestryCheck = false;
            for (i = 0; i &lt; inputObjects.length; i++) { // TODO
                if ($(event.target).parents().index(inputObjects[i].input) === -1) {
                    ancestryCheck = true;
                    break;
                }
            }
            that.close();           //only closes if clicked off menu
        });
    }
    
    /**Close menu
     * Doesn&#x27;t fire if menuCloseable is set
     * Call only from my.root close handler
     * @method close
     * @param {Boolean} preventClose
     */
    function close(preventClose) {
        forceClose(preventClose);
    }
    
    /**Actually closes menu, no menuCloseable check
     * Call everywhere except my.root handler
     * @method forceClose
     * @param {Boolean} preventClose
     */
    function forceClose(preventClose) {
        var i;

        my.root.off(&#x27;mousedown.editorMenu&#x27;);
        my.timeline.setisMenuOpen(false);
        my.timeline.setCloseMenu(null);
        my.that.updateTracksEventsPaused(false);

        menu.hide();
        arrow.hide();

        // save current input states
        if (!preventClose) {
            for (i = 0; i &lt; inputObjects.length; i++) {
                updateInput(inputObjects[i]);
            }
        }
    }
    

    //////////////////
    // CONSTRUCTION //
    //////////////////

    /**Adds an input element to the menu
     * @method addInput
     * @param {String}   name               Name of element (appears on menu)
     * @param            format             MenuInputFormat type
     * @param {Function} accessCallback     Function for obtaining current value of linked variable
     * @param {Function} updateCallback     Function for updating value of linked variable
     */
    function addInput(name, format, accessCallback, updateCallback) {
        var inputObj = {},
            inputContainer = $(document.createElement(&#x27;div&#x27;)),
            inputGroup = $(document.createElement(&#x27;div&#x27;)),
            input = $(document.createElement(&#x27;input&#x27;)),
            units = $(document.createElement(&#x27;text&#x27;));

        // set up input
        input.attr(&#x27;type&#x27;, &#x27;text&#x27;);
        input.val(convertToString(accessCallback(), format)); // TODO: ??? do I need to parse to proper format?
        input.css({
            width: &#x27;15%&#x27;,
            position: &#x27;absolute&#x27;,
            right: &#x27;40%&#x27;
        });
        input.on(&#x27;click&#x27;, function (ev) {
            input.select();
            ev.stopImmediatePropagation();
        });
        input.on(&#x27;MSPointerDown&#x27;, function (ev) {
            ev.stopImmediatePropagation();
        });
        input.keypress(function (evt) { // update on enter push
            if (evt.keyCode === 13) {
                updateInput(inputObj);
                resetInputs();
            }
        });

        // set up units
        units.css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;float&#x27;: &#x27;right&#x27;,
            &#x27;font-size&#x27;: &#x27;80%&#x27;,
            &#x27;right&#x27;: &#x27;15px&#x27;
        });

        // change text when for different formats of an input
        switch (format) {
            case TAG.TourAuthoring.MenuInputFormats.minSec:
                units.text(&#x27;min:sec&#x27;);
                break;
            case TAG.TourAuthoring.MenuInputFormats.sec:
                units.text(&#x27;secs&#x27;);
                break;
            case TAG.TourAuthoring.MenuInputFormats.percent:
                units.text(&#x27;percent&#x27;);
        }

        // assemble container and attach to menu
        inputContainer.css({
            width: &quot;95%&quot;,
            &#x27;margin-left&#x27;: &#x27;auto&#x27;,
            &#x27;margin-right&#x27;: &#x27;auto&#x27;,
            &#x27;font-size&#x27;: TAG.Util.getFontSize(57),
            &#x27;padding-top&#x27;: &#x27;3%&#x27;,
        });
        inputContainer.append(name);
        inputContainer.append(input);
        inputContainer.append(units);
        menu.append(inputContainer);

        // assemble object
        inputObj.input = input;
        inputObj.accessCallback = accessCallback;
        inputObj.updateCallback = updateCallback;
        inputObj.format = format;
        inputObjects.push(inputObj);
    }
    
    /**Adds text w/ no related input or button
     * @method addTitle
     * @param {String} title     Text to appear
     */
    function addTitle(title) {
        var titlediv = $(document.createElement(&#x27;label&#x27;));
        titlediv.text(title);
        titlediv.css({
            &quot;left&quot;: &quot;auto&quot;,
            &quot;top&quot;: &quot;auto&quot;,
            &quot;position&quot;: &quot;relative&quot;,
            &quot;font-size&quot;: TAG.Util.getFontSize(71.5),
            &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;,
            &quot;display&quot;: &quot;block&quot;,
            &#x27;padding&#x27;: &#x27;4%&#x27;,
            &#x27;text-align&#x27;: &#x27;center&#x27;
        });
        menu.append(titlediv);
    }
    
    /**Adds button to screen (click to fire)
     * @method addButton
     * @param {String}       title     Text to appear in button
     * @param {CSS property} floatPos  Side of screen to float to
     * @param {Function}     callback  Function to fire when clicked
     */
    function addButton(title, floatPos, callback) {
        var buttondiv = $(document.createElement(&#x27;label&#x27;));
        buttondiv.text(title);//sets button text
        buttondiv.css({
            &quot;left&quot;: &quot;0%&quot;,
            &quot;position&quot;: &quot;relative&quot;,
            &quot;top&quot;: &quot;5%&quot;,
            &quot;font-size&quot;: TAG.Util.getFontSize(57),
            &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;,
            &quot;display&quot;: &quot;block&quot;,
            &#x27;padding&#x27;: &#x27;10px 0&#x27;,
            &#x27;text-align&#x27;: &#x27;center&#x27;,
            &#x27;margin-left&#x27;: &#x27;3%&#x27;,
            &#x27;margin-right&#x27;: &#x27;3%&#x27;,
            float: floatPos
        });

        // additional css edits:
        switch (menuType) {
            case TAG.TourAuthoring.MenuType.track:
                buttondiv.css({
                    &#x27;width&#x27;: &#x27;93%&#x27;,
                    &#x27;height&#x27;: &#x27;16%&#x27;,
                    &#x27;border-style&#x27;: &#x27;solid&#x27;,
                    &#x27;border-width&#x27;: &#x27;2px&#x27;,
                    &#x27;margin-left&#x27;: &#x27;3%&#x27;,
                    &#x27;margin-right&#x27;: &#x27;3%&#x27;,
                    &#x27;margin-bottom&#x27;: &#x27;3%&#x27;,
                    //&#x27;padding-bottom&#x27;: &#x27;2%&#x27;,
                    top: &#x27;&#x27;
                });
                break;
        }

        menu.append(buttondiv);
        TAG.Util.makeManipulatable(buttondiv[0], {
            onTapped: callback
        });
        return buttondiv;
    }
    
    /**Updates linked variable with new value in input
     * @method updateInput
     * @param {HTML Element} inputObj      Input to update
     */
    function updateInput(inputObj) {
        var command,
            oldValue = inputObj.accessCallback(),
            newValue = inputObj.input.val(),
            num_clamped;

        /**Log clamping undo/redo
         * @method logHelper
         * @param {} disp
         * @param {} cinit
         * @param {} cnew
         */
        function logHelper(disp, cinit, cnew) {
            var clamp_command = {
                execute: function () { disp.setTimes(cnew); },
                unexecute: function () {
                    console.log(&quot;init: &quot; + cinit.inStart + &quot;, new: &quot; + cnew.inStart);
                    disp.setTimes(cinit);
                },
            };
            my.undoManager.logCommand(clamp_command);
            disp.has_been_clamped = false;
        }

        // if input is valid, push to callback
        if (isValidInput(newValue)) {
            // convert text to proper return format
            newValue = convertToUpdateFormat(newValue, inputObj.format);
            if (Math.abs(oldValue - newValue) &gt; TAG.TourAuthoring.Constants.epsilon) {
                my.timeline.getClampedDisplays().length = 0;
                command = {
                    execute: function () {
                        inputObj.updateCallback(newValue);
                        inputObj.input.val(convertToString(inputObj.accessCallback(), inputObj.format));
                        my.update();
                    },
                    unexecute: function () {
                        inputObj.updateCallback(oldValue);
                        inputObj.input.val(convertToString(inputObj.accessCallback(), inputObj.format));
                        my.update();
                    }
                };
                command.execute();
                my.undoManager.logCommand(command);

                num_clamped = my.timeline.getClampedDisplays().length;
                for (var i = 0; i &lt; num_clamped; i++) {
                    var disp = my.timeline.getClampedDisplays()[i];
                    logHelper(disp, disp.clamped_init, disp.clamped_new);
                }
                my.undoManager.combineLast(num_clamped + 1);
            }
        }
        // update val with new internal value
        inputObj.input.val(convertToString(inputObj.accessCallback(), inputObj.format));
    }

    /**Resets inputs to match current state of associated variables
     * @method resetInputs
     */
    function resetInputs() {
        var i,
            inputObj;

        for (i = 0; i &lt; inputObjects.length; i++) {
            inputObj = inputObjects[i];
            inputObj.input.val(convertToString(inputObj.accessCallback(), inputObj.format));
        }
    }

    /**Updates position of menu and brings it on-screen
     * @method updateMenuPos
     * @param {Event} evt   Interaction event object
     */
    function updateMenuPos(evt) {
        var menuLeft,
            menuTop,
            arrowLeft,
            arrowTop,
            trackLim;

        menu.show();
        arrow.show();

        switch (menuType) {
            case TAG.TourAuthoring.MenuType.display:
            case TAG.TourAuthoring.MenuType.keyframe:
                menuLeft = my.track.offset().left + evt.position.x - (menu.width() / 2);
                arrowLeft = menuLeft + (menu.width() / 2) - (arrow.width() / 2);
                arrowTop = my.track.offset().top;
                menuTop = arrowTop - menu.height()-3; // 10 is top margin of menu
                menuLeft = Math.min(menuLeft, $(document).width() - menu.width());
                break;
            case TAG.TourAuthoring.MenuType.track:
                menuTop = my.track.offset().top + my.track.height() / 2 - menu.height() / 2;
                arrowTop = menuTop + menu.height() / 2 - arrow.height() / 2;
                menuTop = Math.min(menuTop, (trackBody.offset().top + trackBody.height()) / 2 + $(document).height() / 2 - menu.height());

                // keep left the same
                menuLeft = menu.offset().left;
                arrowLeft = arrow.offset().left;
                break;
        }

        menu.css({
            left: menuLeft + &quot;px&quot;,
            top: menuTop + &#x27;px&#x27;
        });
        arrow.css({
            left: arrowLeft + &#x27;px&#x27;,
            top: arrowTop + &#x27;px&#x27;
        });
    }

    ///////////
    // UTILS //
    ///////////

    /**Performs input validation
     * @method isValidInput
     * @param {String} inputstr     string to check
     * @return {Boolean} boolean    whether input is valid or not
     */
    function isValidInput(inputstr) {                       //works for both mm:ss and seconds input
        var i,
            letter,
            coloncounter = 0;

        if (!inputstr) {
            return false;
        }

        for (i = 0; i &lt; inputstr.length; i) {               //for each character in string
            letter = inputstr.charAt(i);
            if (letter === &#x27;:&#x27;) {
                coloncounter++;
            }
            if (coloncounter &gt; 1 || (isNaN(parseFloat(letter)) &amp;&amp; letter != &quot;.&quot; &amp;&amp; letter != &#x27;:&#x27;)) {//if too many colons, or any 
                return false;                               //if too many colons or any character invalid
            }
            i = i + 1;
        }
        return true;                                        //no problems!!
    }

    /**Converts string to number according to input format type
     * @method convertToUpdateFormat
     * @param {String} valuestr         new value in string form
     * @param {Value}  format           MenuInputFormat value specifying input format
     * @return {Value} updated String   input value in update required format
     */
    function convertToUpdateFormat(valuestr, format) {
        var min,
            sec;

        switch (format) {
            case TAG.TourAuthoring.MenuInputFormats.minSec:
                // &#x27;min:sec&#x27;: --&gt; secs
                valuestr = valuestr.split(&#x27;:&#x27;);
                if (valuestr.length === 1) { // no min at all
                    return parseFloat(valuestr[0]);
                } else {
                    if (valuestr[0]) min = parseFloat(valuestr[0]);
                    else min = 0; // catch case where input is &#x27;:sec&#x27;
                    sec = parseFloat(valuestr[1]);
                    return sec + 60 * min;
                } break;

            case TAG.TourAuthoring.MenuInputFormats.sec:
                // &#x27;secs&#x27; --&gt; secs
            case TAG.TourAuthoring.MenuInputFormats.percent:
                // &#x27;percent&#x27; --&gt; percent
                return parseFloat(valuestr);
        }
    }

    /**Converts value (typically from accessCallback) to string
     * to place in input HTML element
     * @method convertToString
     * @param {Number}  value     Value as number
     * @param {Format]  format    MenuInputFormat type specifying format to parse number to
     * @return {String} string    value converted to string
     */
    function convertToString(value, format) {
        var min,
            sec;
        switch (format) {
            case TAG.TourAuthoring.MenuInputFormats.minSec:
                // &#x27;min:sec&#x27;: --&gt; secs
                min = Math.floor(value / 60);
                if (min &lt; 10) {
                    min = &#x27;0&#x27; + min;
                }
                sec = value % 60;
                sec = roundDecimals(sec);
                if (sec &lt; 10) {
                    sec = &#x27;0&#x27; + sec;
                }
                return min + &#x27;:&#x27; + sec;

            case TAG.TourAuthoring.MenuInputFormats.sec:
                // &#x27;secs&#x27; --&gt; secs
            case TAG.TourAuthoring.MenuInputFormats.percent:
                // &#x27;percent&#x27; --&gt; percent
                return roundDecimals(value) + &#x27;&#x27;;
        }
    }

    /**Round number to have only
     * @method roundDecimals
     * TAG.TourAuthoring.Constants.menuDecimals decimal places
     * @param {Number} num       number to round
     * @return {Number} number   rounded number
     */
    
    function roundDecimals(num) {
        return Math.round(num * power) / power;
    }

    return that;
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
